<header class="site-header px-4 py-3">

  <% if user_signed_in? && !current_user.guest? %>
    <!-- Ê§úÁ¥¢„Éê„ÉºÔºàÈÄöÂ∏∏„É≠„Ç∞„Ç§„É≥„ÅÆ„ÅøÔºâ -->
    <div class="search-area d-flex">
      <%= form_with url: users_path, method: :get, local: true, class: "d-flex" do |f| %>
        <%= f.text_field :keyword,
              placeholder: "„É¶„Éº„Ç∂„ÉºÂêç„ÅßÊ§úÁ¥¢",
              class: "form-control me-2" %>
        <%= f.submit "üîç", class: "search-button" %>
      <% end %>
    </div>
  <% end %>

  <div class="d-flex justify-content-between align-items-center">

    <!-- „É≠„Ç¥ -->
    <div class="header-logo">
      <%= link_to root_path do %>
        <%= image_tag "growcake_logo.png", class: "logo-img" %>
      <% end %>
    </div>

    <!-- „Éä„Éì -->
    <nav class="header-nav d-flex align-items-center">

      <% if user_signed_in? %>

        <!-- „Çà„ÅÜ„Åì„ÅùË°®Á§∫ -->
        <span class="welcome-text me-4">
          „Çà„ÅÜ„Åì„Åù„ÄÅ
          <%= current_user.guest? ? "„Ç≤„Çπ„Éà„Åï„Çì" : "#{current_user.name} „Åï„Çì" %>
        </span>

        <!-- ÂÖ±ÈÄö„É™„É≥„ÇØ -->
        <%= link_to "About", about_path, class: "nav-link me-3" %>
        <%= link_to "ÊäïÁ®ø‰∏ÄË¶ß", posts_path, class: "nav-link me-3" %>

        <% if current_user.guest? %>
          <!-- „Ç≤„Çπ„ÉàÂ∞ÇÁî®Ë°®Á§∫ -->
          <span class="nav-link me-3 guest-text">„Ç≤„Çπ„Éà„É≠„Ç∞„Ç§„É≥</span>

        <% else %>
          <!-- ÈÄöÂ∏∏„É≠„Ç∞„Ç§„É≥„ÅÆ„Åø -->
          <% unread_count = current_user.notifications.unread.count %>

          <div class="header-icons d-flex align-items-center">

            <!-- üîî ÈÄöÁü• -->
            <div class="notification-wrapper">
              <button
                id="notificationToggle"
                class="header-icon notification-bell me-3 <%= 'has-unread' if unread_count > 0 %>"
                type="button"
              >
                <%= image_tag "bell.png", class: "header-icon-img", alt: "ÈÄöÁü•" %>

                <% if unread_count > 0 %>
                  <span class="notification-badge">
                    <%= unread_count > 9 ? "9+" : unread_count %>
                  </span>
                <% end %>

                <span class="header-icon-text">ÈÄöÁü•</span>
              </button>

              <div id="notificationDropdown" class="notification-dropdown">
                <% notifications = current_user.notifications.order(created_at: :desc).limit(5) %>

                <% if notifications.any? %>
                  <% notifications.each do |notification| %>
                    <div class="notification-item <%= 'unread' unless notification.read %>">
                      <p class="message"><%= notification.message %></p>
                      <span class="time">
                        <%= time_ago_in_words(notification.created_at) %>Ââç
                      </span>
                    </div>
                  <% end %>

                  <div class="notification-footer">
                    <%= link_to "„Åô„Åπ„Å¶„ÅÆÈÄöÁü•„ÇíË¶ã„Çã", notifications_path %>
                  </div>
                <% else %>
                  <p class="empty">ÈÄöÁü•„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì üç∞</p>
                <% end %>
              </div>
            </div>

            <!-- „ÅÑ„ÅÑ„Å≠ -->
            <%= link_to likes_path, class: "header-icon me-3" do %>
              <%= image_tag "heart_active.png", class: "header-icon-img" %>
              <span class="header-icon-text">„ÅÑ„ÅÑ„Å≠</span>
            <% end %>

            <!-- „Éû„Ç§„Éö„Éº„Ç∏Ôºà„Ç¢„Ç§„Ç≥„É≥Ôºâ -->
            <%= link_to mypage_path, class: "header-icon me-3" do %>
              <%= image_tag "mypage-icon.png", class: "header-icon-img" %>
              <span class="header-icon-text">„Éû„Ç§„Éö„Éº„Ç∏</span>
            <% end %>

            <!-- ÂèãÈÅîÊãõÂæÖ -->
            <%= link_to invite_path, class: "header-icon me-3" do %>
              <%= image_tag "invite-icon.png", class: "header-icon-img" %>
              <span class="header-icon-text">ÂèãÈÅîÊãõÂæÖ</span>
            <% end %>

          </div>
        <% end %>

        <!-- „É≠„Ç∞„Ç¢„Ç¶„Éà -->
        <%= link_to "„É≠„Ç∞„Ç¢„Ç¶„Éà",
              destroy_user_session_path,
              method: :delete,
              class: "nav-link me-3" %>

      <% else %>

        <!-- Êú™„É≠„Ç∞„Ç§„É≥ -->
        <%= link_to "About", about_path, class: "nav-link me-3" %>
        <%= link_to "„Ç≤„Çπ„Éà„É≠„Ç∞„Ç§„É≥", users_guest_sign_in_path, method: :post, class: "nav-link me-3" %>
        <%= link_to "„É≠„Ç∞„Ç§„É≥", new_user_session_path, class: "nav-link me-3" %>
        <%= link_to "Êñ∞Ë¶èÁôªÈå≤", new_user_registration_path, class: "nav-link me-3" %>

      <% end %>

    </nav>
  </div>
</header>