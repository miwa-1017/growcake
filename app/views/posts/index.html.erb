<div class="posts-wrapper">
  <h2>みんなの投稿</h2>

  <div class="posts-container">
    <% @posts.each do |post| %>
      <% stage = post.user.current_stage %>
      <div class="post-card stage-<%= stage %>">

        <% if post.image.attached? %>
          <%= image_tag post.image, class: "post-card-img" %>
        <% else %>
          <%= image_tag "cakes/cake_stage_01.png", class: "post-card-img default-img" %>
        <% end %>

        <div class="post-card-content">
          <p class="post-user">👤 <%= post.user.name %></p>
          <p class="post-exercise">🏃 <%= post.exercise.presence || "運動なし" %></p>
          <p class="post-body"><%= truncate(post.body, length: 30) %></p>
          <p class="post-date">📅 <%= post.created_at.strftime("%Y/%m/%d") %></p>
        </div>

        <% if post.comments.any? %>
          <p class="comment-count">
            💬 <%= post.comments.count %>件  
            （最新：「<%= truncate(post.comments.last.content, length: 10) %>」）
          </p>
       <% else %>
          <p class="comment-count">
            💬 まだコメントはありません
          </p>
       <% end %>

        <div class="post-card-actions">
          <%= link_to "詳しく見る", post_path(post), class: "card-btn" %>
        </div>

        <% if post.user == current_user %>
          <%= link_to "編集", edit_post_path(post), class: "card-btn" %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>